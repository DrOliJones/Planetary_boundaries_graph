library(ggplot2)
library(dplyr)
library(tibble)

# Create the data frame for planetary boundaries with line breaks for labels
boundaries_data <- tibble(
    boundary = c("Biosphere Integrity\n(Genetic)", 
                 "Biosphere\nIntegrity\n(Functional)", 
                 "Climate Change\n(CO2 conc.)", 
                 "Climate Change\n(Radiative forcing)", 
                 "Novel Entities", 
                 "Stratospheric\nOzone\nDepletion", 
                 "Atmospheric\nAerosol\nLoading", 
                 "Ocean\nAcidification", 
                 "Biogeochemical\nFlows (P)", 
                 "Biogeochemical\nFlows (N)", 
                 "Freshwater Change\n(Blue)", "Freshwater\nChange\n(Green)", 
                 "Land\nSystem\nChange"),
    value = c(6.5, 4.5, 2.3, 4.5, 4.7, 1.4, 1.7, 1.9, 4.8, 4.5, 2.3, 2.5, 3.5),
    max_value = 10
)

# Define risk zone color scale
color_scale <- c("Safe" = "#FFFFFF", "Increasing Risk" = "#7D7D7D", "High Risk" = "#000000")

# Factor levels to retain order in polar coordinates
boundaries_data <- boundaries_data %>%
    mutate(boundary = factor(boundary, levels = boundary), # Maintain order
           risk_zone = cut(value, breaks = c(0, 2.2, 4.4, 10), labels = c("Safe", "Increasing Risk", "High Risk")))

# Plot with coord_polar and larger circle size
ggplot(boundaries_data) +
    geom_bar(aes(x = boundary, y = value, fill = risk_zone), stat = "identity", color = "black", width = 0.9) +
    scale_fill_manual(values = color_scale) +
    coord_polar(theta = "x", start = 0) +
    # Place labels further outside the circle and keep them upright
    geom_text(aes(x = boundary, y = max_value - 2.5, label = boundary), # Adjust y position for labels
              angle = 0, hjust = 0.5, size = 3) + 
    # Add radial lines for reference
    geom_hline(yintercept = c(0, 1, 2, 3.5, 5), color = "dark grey", linetype = "dotted") +
    ylim(0, max(boundaries_data$max_value) + 0.5) + # Expand y-axis limits for larger circle
    theme_minimal() +
    labs(title = "", fill = "Risk Zone") +
    theme(axis.text = element_blank(),
          axis.title = element_blank(),
          panel.grid = element_blank(),
          plot.title = element_text(hjust = 0.1, size = 1), legend.text = element_text(size = 9), 
          legend.title = element_text(face="bold")+
              theme_bw()) + theme(
                  legend.position = c(.95, .95),
                  legend.justification = c("right", "top"),
                  legend.box.just = "right",
                  legend.margin = margin(6, 3, 6, 6)
              )
